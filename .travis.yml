dist: bionic
install:
- sudo docker login -u "amrox" -p "$DPWD"
- sudo bash install/bootstrap_dev.sh
- sudo docker-compose -f ./install/docker-compose_unit.yml up -d mysql-unit redis-unit
before_script:
- sleep 120
script:
- configstore package test
- sudo docker ps
- sudo docker login -u "amrox" -p "$DPWD"
- sudo configstore package process_templates unit /etc
- sudo mysqlcheck --host mysql -uroot -ppassword  --databases greencandle
- cat  config/template/gc-cron |grep -v ^{| sudo crontab -
- cat config/template/*.json|jq
- sudo greencandle/tests/travis_tests.sh "not docker"
- sudo greencandle/tests/travis_tests.sh "docker"
after_success:
- sudo bash create_images.sh
notifications:
  slack:
    rooms:
      - secure: NLPQBKmA9zPSR7uHyLexq1RQYNogINxYZ2bmaP9U5qIr4/caJlVQCEDdA7exO1SIrdCABJKzmg/WJPWZdNVAwaJtFIkxOEVT+mXjvJdRK1avKweLk+hitYRCccI3Nx1SeU0wggXJFGQUpWhEHr6zR1/lBwQNC3N1Q46AWp/V7ga7NdP6yBs0CVSENWxOTX2snUKnj1tSZPqN5HpK3LSAhbjIck7YPMc8wv1m0ClhdQ7FjoZJLaBBnSXAzh89q3mumdaQatDmIKp5jjGffngRGey1/RwPIBGJus/SZjJVSw2nBWlnnGFpqxunoYIKYFgSO4zd92QwIoOfLD9oWUrx8J7JHGmxxGr752ZBoNm3AUDkYMRcM5weDQiL3NwKTld1M0+J22sL9j7LtsMO1ogghyUn9jRTnIoY+Le5oUt1ibXlsKKaMxWq3bQ9deJzezvift5K8py0YuvC0et180n2D6UNKFprBxF9Jzxpq67DgcKWvPu+7RCdI6nBewyXSQrkdJ0WZOIfSxsAlyt0XWmZBaENsyNsBaDEWUmuLB4/KIocnux0zYtxagjfftEbCGyhr0uKbBPysOI6v21Elj5lcyVOhQfUxsuGiRDdA+7X6F8UnMEfsjI+Y5O62gRpdunoK+mxTsHT5kx3f2BzfPGjlxJGox453nMQidme42s/QvM=
    on_success: always
    on_failure: always
    template:
      - "Repo `%{repository_slug}` *%{result}* build (<%{build_url}|#%{build_number}>) for commit (<%{compare_url}|%{commit}>) on branch `%{branch}`."
      - "Execution time: *%{duration}*"
      - "Message: %{message}"
env:
  global:
    secure: mtCBYIQvXS0q5u6IsaS58Ma5c4Ccl6rbCcdS3L0b1e2i4+CXDjJHh2766mVJPlPPHVhi088Fkjw/Thzvs2YXGaR06nubxkrP0jFyBrOtT/muVfcNyaJCn7XdPA01uZUnouqwVdyrdNJV3vJuuJN9l942sCiQ5s5au1gcQ+xf6YkYR4O5ejWoIja7u7aDBEurzs9XjoZIIHohYhV6y8bERz+02PhUUN9a696nXzbrX+vhw+vGUBOdoNbGWXgtBcN4x2Uwz7EgMpQycKYL9CBzp/KfNq3CIGPf3JvwvCF8gu4h7olssvQ5WoXW2tr10TU6JwhPN2YdRIoedS69zRa09s+Sw964Tk8rTO7hlWrYIxgeA2e+U61lNykq0JX3Q6eGTF8ltK0qAJ4bylwH8wSYytzdZ5fWE0+K0sWvu6+QakH570wHVJoV6fNcNCPfSm4CGJhG2tDlYQYuaZhKo5L8rAXNY+hmo2s6a5oANrR15cIiyE00rxihgyX8qwAbZno4e57MFIIMx7RWSdmCell1tGgR1G095GbN5C9rpklVN5RShSes9WK1eTiGy+5mtEBL4Vbx0A1+kslhOHAIi/my0dmmuKQmMLJAjE6N639EG5gt53jLES3oKW5CBWyHqa9XACSUuRgHg+rpEzj2blohd7C0ldT7fouylDBPqfY0wqg=
